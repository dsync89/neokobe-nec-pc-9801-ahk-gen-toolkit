# NeoKobe NEC PC-98 AHK Gen Toolkit

This set consolidates the NeoKobe NEC PC-98 games from [archive.org](https://archive.org/details/NeoKobe-NecPc-98012017-11-17), reorganizing them to follow a more universally accepted folder structure for ease of access and usage.

## Motivation

The [Neo Kobe - NEC PC-9801 (2017-11-17) set](https://archive.org/details/NeoKobe-NecPc-98012017-11-17) structured games by Publisher as the primary folder level, followed by the Game Title. However, most frontends prefer a System > Game Title hierarchy. These scripts aim to transform these sets into such an organization.

Additionally, the absence of a DAT file for this Neo Kobe PC-98 set prompted the development of these scripts. As each game title might possess various boot sources (FD, HD, CD), the scripts handle extraction and organization accordingly. Refer to [How the media type is decided for each game title](#how-the-media-type-is-decided-for-each-game-title) for detailed insights.

Furthermore, for convenient gameplay without relying on frontends like Launchbox or RocketLauncher to pass command line arguments, the scripts generate AHK files per game title. This allows for easy double-click execution while managing necessary boot media types per game title. Explore [How the boot media type is decided for the game](#how-the-media-type-is-decided-for-each-game-title) for specifics.

## Quick Setup

1. Extract downloaded zip files from [Neo Kobe - NEC PC-9801 (2017-11-17) set](https://archive.org/details/NeoKobe-NecPc-98012017-11-17) while preserving the folder structure. **DO NOT FLATTEN THE FOLDER STRUCTURE!**
2. Modify `config.json` to specify paths for:
```
{
    "rom_dir": "s:\\_nec pc-98",  <== Where you download the NeoKobe PC-98 set
    "extracted_fd_rom_dir": "s:\\_nec pc-98_out2\\FD",  <== Where you want to store the extracted FD game titles
    "extracted_hd_rom_dir": "s:\\_nec pc-98_out2\\HD",  <== Where you want to store the extracted HD game titles
    "extracted_cd_rom_dir": "s:\\_nec pc-98_out2\\CD",  <== Where you want to store the extracted CD game titles
    "emuPath": "C:\\Users\\Gary\\Downloads\\np21w-0.86-rev91\\np21w-0.86-rev91\\bin\\np21w.exe",  <== The location of your np21w emulator>
    "gamedb_cd_overwrite_file": "gamedb\\gamedb_cd_overwrite.txt",
    "gamedb_hd_overwrite_file": "gamedb\\gamedb_hd_overwrite.txt",
    "gamedb_fd_overwrite_file": "gamedb\\gamedb_fd_overwrite.txt"    
}
```

Run the following Python scripts in the following order:
1. `extract_files.py`: Extract each game titles to a base folder for a media type `[CD, HD, FD]`. Each media type folder only contains a single level game title folder.
2. `consolidate_folders.py`: Strip `[FD]` and `[HD]` suffix for `FD` and `HD` media. For `CD` media type, several folders are merged and moved to a single game title, especially for game title that have different folder such as `[CD floppy], [CD]`
3. `gen_gamedb.py`: Generate a `.gamedb.txt` file which contains all the boot source media types.
4. `gen_gamedb_with_overrides.py`: Override `.gamedb.txt` with user specific entry in `gamedb/gamedb_<media_type>_overwrite.txt`
5. `gen_ahk_files.py`: Generate AHK files for each game to run it.
6. `add_keymapper_to_ahk.py`: Applying global keymap from `keymapping\<media_type>\global.ahk` and game specific keymap from the same folder to each game AHK script generated by `gen_ahk_files.py`.
# Features

1. List and group all games by Game Title and Media Type.
2. Extract games in the folder hierarchy of `[Media Type] > [Game Title]`. There are three folders based on Media Type: [FD, HD, or CD]. You can decide on the location for these media type folders.
3. AHK file per game title allowing you to double click and execute the game directly, without having to use any front end such as LaunchBox or RocketLauncher. You can also easily integrate these AHK files to LB by simply importing the .ahk files, then configure them to launch these fles using AutoHotKey program.
4. User defined keybindings per game to the game AHK files

There exist other method that only has a single AHK file which will use the rom file as input, such as [this](https://gist.github.com/bitgamma/acb3001732ba722feb4bc0539941e133) AHK script written by a LaunchBox forum member @xiron [here](https://forums.launchbox-app.com/topic/69356-neko-project-21w-integration-made-easy/) . But I still decided to generate AHK files individually for each game title to make it easier to use, and to decouple with other front end launcher.

# FAQ

## How AHK script works?
The script first find a matching row for the game in `.gamedb.txt`. If the match is found by game title (first element of `|`, it will parse the boot sources and categorize them according to their file extension. E.g. `.hdm` will be categorized as HDM, `.ccd` as CCD, and `.hdi` as HD.

For AHK scripts in FD media type, passing the argument is very straightforward since `np2w.exe` support passing FDD files as argument

AHK script in HD and CD media type is a bit tricky as the emulator doesn't support argument passing for HDI and CCD files, so the script will copy the `np2w.ini` file from the emulator folder, then make a copy of it and named it as `np2w_lb.ini`, then replace `HDD1FILE=` with the detected HDD file, and `CD3_FILE=` line with the detected CCD file. The FDD files is still passed as argument.

## How the media type is decided for each game title?
A game is extracted to either one of the media type base folder FD, HD or CD depending on the following conditions:
- FD: if and only if that game title only contains zip file with [FD] suffix
- HD: if both [HD] and [FD] suffix is found, but not [CD]
- CD: if at least one [CD] suffix is found, with zero or more zip with [HD] and [FD] suffix


FD folder would only contains floppy disk images, such as .hdm, .n88, .d88, etc. 

HD folder will always contain .hdi, but with optional floppy disk image if any. Some games require the floppy boot disk to boot the installed HD game.

CD folder will always contain one of CD image (.iso, .ccd, .img), and HD and FD files if any. Some games might require all 3 media types to insert in order to boot properly, e.g. Policenaut.

## How the boot media type is decided for the game?

The AHK script will first find the boot media type for each game. It does this by looking up the matching game title in a row in `.gamedb` file at the root of the media type folder. Each row in `.gamedb.txt` consist of `Game Title | boot source 1 | boot source 2 | ...` Some game title require media type to be inserted in a certain order, espeically for FD game where FDD1 is usually the boot disk, and FDD2 is the data disk. So some manual entry is still needed. I welcome user contribution to modify this `.gamedb.txt` file if you find the boot source need to be swapped.

# Contribution

Contribution are welcomed in two aspects.

## Game Boot Order
Since the total games is vast and I only randomly test some titles, there bound to be some game titles requiring modified boot source. If you find any games require manual overwrite, submit a pull request for the `gamedb\overwrite.txt file`.

## Keymap
Add any game specific keymapping to `keymapping\<media_type>\<game_folder>`. For example, to add a game mapping for `HD` game `Rusty`, create `Rusty.ahk` under `keymapping\hd\`. Any ahk files read here will then be appended by the `add_keymapper_to_ahk` script.