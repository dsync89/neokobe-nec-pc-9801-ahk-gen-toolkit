# NeoKobe NEC PC-98 AHK Gen Toolkit

This toolkit generate a one-click AHK files to run Neo Kobe NEC PC-9801 games from [archive.org](https://archive.org/details/NeoKobe-NecPc-98012017-11-17). It is recommended to consolidate the Neo Kobe set using the DAT that I created in `dat\1g1r\` using your favorite rom manager like RomUltra (my personal favorite), RomCenter, or clrmamepro among the others.

## Motivation

The [Neo Kobe - NEC PC-9801 (2017-11-17) set](https://archive.org/details/NeoKobe-NecPc-98012017-11-17) structured games by Publisher as the primary folder level, followed by the Game Title. However, most frontends prefer a **Platform > Game Title** hierarchy which can be easily achieved using the DAT file that I created and let your RomManager to do the job.

Many multi-disks game, or even multi-media types games require a certain type of boot media or boot order to setup in the emulator to properly boot. This makes it a pain when you are trying to pick a random game from such a huge library collection. 

The ideal way to run this game is then to have a one-click way to run. As such, I've written scripts here that generate AHK (v2) files per game title which will lookup the right media type and boot order to launch for each game. Read [How the boot media type is decided for the game](#how-the-media-type-is-decided-for-each-game-title) for more details.

Not only that these AHK files can be running independently of any frontend or launcher, you can even import them to your favorite frontends like Launchbox or RocketLauncher. Just set the emulator to AHK v2 launcher!

## Quick Setup

1. Extract downloaded zip files from [Neo Kobe - NEC PC-9801 (2017-11-17) set](https://archive.org/details/NeoKobe-NecPc-98012017-11-17) while preserving the folder structure. **DO NOT FLATTEN THE FOLDER STRUCTURE!**

2. Organize the extracted sets using RomManager so that the folder is in **Game Title** tree hierarchy, instead of per publisher. Use the DAT from `dat/1g1r` to create a 1G1R Set.

3. Modify the `rom_dir` field in `config.json`:
```
{
    "rom_dir": "s:\\roms-1g1r\\neokobe-dsync-nec-pc-9801-fd+hd+cd", 
    "gamedb_overwrite_file": "gamedb\\gamedb_overwrite.txt"
}
```

4. Modify the `EmuPath` in `templates/.config.ini` that the AHK script will find the emulator to run the game.

5. Run `runall.bat`. 

The batch script will call the following python scripts:

1. `gen_gamedb.py`: Generate a `.gamedb.txt` file which contains all the boot source media types for each game titles.
2. `gen_gamedb_with_overrides.py`: Override `.gamedb.txt` with the entry in `gamedb/gamedb_overwrite.txt` to override the default boot order.
3. `gen_ahk_files.py`: Generate AHK files for each game to run it.
4. `add_keymapper_to_ahk.py`: Apply global keymap from `keymapping\<media_type>\global.ahk` and game specific keymap from the same folder to each game AHK script generated by `gen_ahk_files.py`.

---

# Features

1. AHK file for each game title that you can simply double click to play the game, without having to use any front end such as LaunchBox or RocketLauncher. You can also easily integrate these AHK files to LB by simply importing the .ahk files, then configure them to launch these files using AutoHotKey program.
2. User defined keybindings per game to the game AHK files

There exist other method that only has a single AHK file which will use the rom file as input, such as [this](https://gist.github.com/bitgamma/acb3001732ba722feb4bc0539941e133) AHK script written by a LaunchBox forum member @xiron [here](https://forums.launchbox-app.com/topic/69356-neko-project-21w-integration-made-easy/) . But I still decided to generate AHK files individually for each game title to make it easier to use, and to decouple with other front end launcher.

---

# FAQ

## How AHK script works?
The script first find a matching row for the game in `.gamedb.txt`. If the match is found by game title (first element of `|`, it will parse the boot sources and categorize them according to their file extension. E.g. `.hdm` will be categorized as HDM, `.ccd` as CCD, and `.hdi` as HD.

For AHK scripts in FD media type, passing the argument is very straightforward since `np2w.exe` support passing FDD files as argument

AHK script in HD and CD media type is a bit tricky as the emulator doesn't support argument passing for HDI and CCD files, so the script will copy the `np2w.ini` file from the emulator folder, then make a copy of it and named it as `np2w_lb.ini`, then replace `HDD1FILE=` with the detected HDD file, and `CD3_FILE=` line with the detected CCD file. The FDD files is still passed as argument.

Update: 
AHKv1 scripts are now updated to AHKv2 to fix an issue where the emulator would not show up but the script is actually running when launching AHKv1 script via the command line (e.g. Launchbox). Strangely double clicking on AHKv1 script will run the emulator just fine. It's still better to use v2 for various reasons though, so here it is!

## How do you select which media type to keep for a title?

For a game that has multiple media type, i.e. FD, HD, and CD:
- HD is **ALWAYS** preferred over FD
- For CD, FD or HD is selected if they contain boot disk that is required to boot the CD. All CD require at least a FD/HD to be inserted to boot. No CD game can boot by itself.

To make these selection systematic and easy to manage, I manually created a Retool 1G1R Clonelist in `dat/retool-clonelist` to tell Retool which titles to select for each game. I manually created the clonelist and to make sure the game, especially CD game titles can run properly.

## How the boot media type is decided for the game?

The AHK script will first find the boot media type for each game. It does this by looking up the matching game title in a row in `.gamedb` file at the root of the media type folder. Each row in `.gamedb.txt` consist of `Game Title | boot source 1 | boot source 2 | ...` Some game title require media type to be inserted in a certain order, espeically for FD game where FDD1 is usually the boot disk, and FDD2 is the data disk. So some manual entry is still needed. I welcome user contribution to modify this `.gamedb.txt` file if you find the boot source need to be swapped.

---

# Contribution

Contribution are welcomed in two aspects.

## Game Boot Order
Since the total games is vast and I only randomly test some titles, there bound to be some game titles requiring modified boot source. If you find any games require manual overwrite, submit a pull request for the `gamedb\overwrite.txt file`.

## Keymap
Add any game specific keymapping to `keymapping\<media_type>\<game_folder>`. For example, to add a game mapping for `HD` game `Rusty`, create `Rusty.ahk` under `keymapping\hd\`. Any ahk files read here will then be appended by the `add_keymapper_to_ahk` script.

---

# Credits

Huge credits goes to the following heroes to make this possible:

**@kobushi** from http://fullmotionvideo.free.fr/phpBB3/viewtopic.php?f=6&t=1621 for consolidating and sharing this amazing romset!

1G1R DAT is generated using **Retool** https://github.com/unexpectedpanda/retool.

DAT is generated using **clrmamepro dir2dat** against Neo Kobe set.